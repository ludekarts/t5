<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>T5Engine</title>
<style>*[data-t5-template]{display:none;}</style>
</head>

<body>
    

    <section style="text-align:center">
        <h1>T5 - Templating Engine</h1>
        <p style="text-align:center"><button id="starter">RUN T5</button></p>
        <a href="repeater.html">Repeater</a>
    </section>
       
    
    <section id="playground">
       <div data-t5-template="playground">
        <h3>{{header}}</h3>
        <p>{{deep.content}}</p>
        
        <div>
            <p repeat="hero in heroes" show="{{(hero.visible > 2)}}" >{{hero.id}}</p>
        </div>
        
        <ul>
            <li repeat="item in list | heroFilter">
                <p>{{item.name}}</p>
                <div repeat="prop in item.props | propsFilter">
                    <h5>Some headeing</h5>
                    <span repeat="num in prop.numbers" show="{{prop.poison}}">{{num}}</span>
                </div>
            </li>
        </ul>
        
        <div>
            <p repeat="x in list">{{x.name}}</p>
        </div>
        <div><img tsrc="{{image}}" alt="" style="max-width:350px; height:auto;"></div>
      </div>
    </section>
        
    <script src="js/doT.js"></script>
    <script src="js/T5.js"></script>
    
    <script>
        (function(){
            
        // Register all templates.
        t5.register();
          
        t5.filter('propsFilter', function(item) {
          return item.poison = true;
        });
          
        t5.filter('heroFilter', function(item) {
          return item.id === 2 ? true : false;
        });
    
        // Get DOM nodes.
        var playground = document.getElementById('playground');
        var startButton = document.getElementById('starter');
            
        // Data objects.
        window.dataSource = {
                header : 'Awsome T5 Template engine',
                deep : {
                    content : 'DEEP lorem ipsum dolor sit amet, consectetur adipisicing elit. '
                },
                list : [
                    {id:1, name : 'Flash',    props : [{ numbers: [1,2,3], poison : true }]},
                    {id:2, name : 'Batman',   props : [{ numbers: [1,2,3,4] , poison : true}]},
                    {id:3, name : 'Superman', props : [{ numbers: [1,2,3,4,5], poison : false}]}                    
                ], 
                heroes : [
                    {id:3, visible: 3, name : 'Cyborg',        props : [1,2,3]},    
                    {id:1, visible: 1, name : 'Wonder Woman',  props : [1,2,3,4]},
                    {id:2, visible: 4, name : 'green Lantern', props : [1,2,3,4,5]},                    
                ],
                image : 'assets/girl.jpg'
            };        
            
        // Click handlers.
        startButton.onclick = initTemplate;
            
        // Functions.
        function initTemplate() {            
            playground.innerHTML = t5.render(dataSource, 'playground');
        }
        
        
            
        function go () {
            var repeater = '<li repeat="item in list"><p>{{item.name}}</p>#inject1#</li>';
            var inners = {   
                inject1 : '<p repeat="prop in item.props">#inject2#</p>',
                inject2 : '<span repeat="num in prop.item">{{num}}</span>'
            }
                    
            function inject(code) {
                code = code.replace(/#([^{}]*)#/, function(a,key) {
                    return inners[key] || '';
                });
                
                return (code.match(/#([^{}]*)#/)) ? inject(code) : code;
            }
            
            return inject(repeater);
        }   
            
        }());    
    </script>
</body>

</html>

