/**
 * T5.js
 * Micro-templating engine with user friendly markup, nested repeaters, custom fiilters adn outputs modifiers.
 *
 * version : 0.4.0
 * author  : Wojciech Ludwin 2016
 * contact : ludekarts@gmail.com, https://wldesign.pl
 * webpage : https://ludekarts.github.io/t5/
 * license : MIT
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.t5=b()}(window,function(){"use strict";var a={},b={},c={},d={},e=function(e,f){if(e&&f){var g=document.createElement("div"),h=document.createRange().createContextualFragment(e);return g.appendChild(h),d[f]=m(g.firstChild,a,b),g=null,h=null,r}var i=Array.prototype.slice.call(document.querySelectorAll("[data-t5]"))||[];return i.forEach(function(e){var f,g=e.getAttribute("data-t5");if(g){if(f=e.cloneNode(!0),f.removeAttribute("data-t5"),f.getAttribute("repeat"))throw new Error('Repeater: "'+g+'" need to have a wrapper node!');d[g]=m(f,a,b),c[g]=e,f=null}}),r},f=function(a){return"&amp;"===a?"&":"&gt;"===a?">":"&lt;"===a?"<":a},g=function(a,b){return a.replace(/'[a-zA-Z+\.]+'|([a-zA-Z+\.]+)/g,function(a,c){return c?b+"."+c:a})},h=function(a,b){return a.replace(/\{\{\s*([0-9A-Za-z\.\[\]]+?)\s*\}\}/g,function(a,c){return"'+"+(b?b+".":"")+c+"+'"})},i=function(a,b){return a.replace(/(&amp;)|(&gt;)|(&lt;)/g,f).replace(/\{\{\s*([\w\']+\.*\w*\s*\:{1}\s*([0-9\!\w\.])+(([0-9\w\s\!\.\>\<\&\'])*(={2,3})*)*)\s*\}\}/g,function(a,c){var d=b?g(c,b).split(":"):c.split(":");return"'+ (("+d[1]+") ? "+d[0]+" : '') +'"})},j=function(a,b,c,d,e){return"(function (repeaterArray, filter, mod) {return repeaterArray.reduce(function (result, "+c+", index) {if (filter && !filter("+c+")) return result;"+c+" = mod ? mod("+c+") : "+c+";return result += '"+i(h(a))+"';}, '');}("+b+", "+d+", "+e+"))"},k=function(a,b,c){var d=a.match(/\>+\s*(\w+)/),e=a.match(/\|+\s*(\w+)/);return{mod:c[d?d[1]:""],filter:b[e?e[1]:""]}},l=function(a,b,c,d){var l,m,o,e=[].slice.call(a.querySelectorAll("[repeat]")),n=!1;return e.reverse().forEach(function(a,e){m=a.getAttribute("repeat"),l=m.split(" "),n=!~l[2].indexOf("."),o=l[3]&&"|"===l[3]||">"===l[3]?k(l.slice(3,l.length).join(" "),c,d):{mod:void 0,filter:void 0},a.outerHTML="'+"+j(a.outerHTML,n?b+"."+l[2]:l[2],l[0],o.filter,o.mod)+"+'"}),i(h(a.outerHTML,b),b).replace(/(&amp;)|(&gt;)|(&lt;)/g,f).replace(/\r?\n|\r/g,"").replace("tsrc","src")},m=function(a,b,c){var d="return '"+l(a,"scope",b,c)+"';";return console.log(d),new Function("scope",d)},n=function(a,b){var e=d[a]?d[a](b).replace(/<(\w*)[^>]*>([\s\S]*?)<\/\1>/,function(a,b,c){return c}):"<< NO TEMPLATE >>",f=c[a];return f&&(f.innerHTML=e),e},o=function(b,c){return"string"==typeof b&&"function"==typeof c&&(a[b]=c),r},p=function(a,c){return"string"==typeof a&&"function"==typeof c&&(b[a]=c),r},q=function(a){return a?d[a]:(console.log(d),r)},r={version:"0.4.0",trace:q,render:n,filter:o,modify:p,template:e};return r});
